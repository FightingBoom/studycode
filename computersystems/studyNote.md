

# 第1章 计算机系统漫游

hello world 程序



## 1.1 信息就是位 + 上下文

基本思想：系统中所有的信息 包括磁盘文件、内 存中的程序、内存中存放的用户数据以及网络上传送的数据，都是由一串比特表示的。区 分不同数据对象的唯 方法是我们读到这些数据对象时的上下文 比如，在不同的上下文 中，一个同样的字节序列可能表示一个整数 浮点数、字符串或者机器指令。



## 1.2 程序被其他程序翻译成不同的格式

![image-20250420174021935](https://cdn.jsdelivr.net/gh/FightingBoom/AllPicture@master/img/202504211008449.png)



- 预处理阶段。预处理器 cpp ，替换 `#` 开头的预处理命令到当前源码文件，生成 *.i 文件。
- 编译阶段。编译器 ccl ，将 *.i 翻译成文本文件 *.s 。
- 汇编阶段。汇编器 as 。
- 链接阶段。链接器 ld 。



## 1.3 了解编译系统如何工作是大有益处的

原因：

- 优化程序性能。
- 理解链接时出现的错误。
- 避免安全漏洞。
    - 学习安全编程的第一步就是理解数据和控制信息存 储在程序栈上的方式会引起的后果。



## 1.4 处理器读并解释存储在内存中的指令

如果该命令不是内置的 shell 命令，那 shell 会假设这是一个可执行文件的名字。



### 1.4.1 系统的硬件组成

![image-20250422081939796](https://cdn.jsdelivr.net/gh/FightingBoom/AllPicture@master/img/202504220819874.png)



1. 总线

贯穿整个系统的是一组电子管道，称作总线，它携带信息字节并负责在各个部件间传 递。通常总线被设计成传送定长的字节块，也就是宇 (word) 。



2. I/O 设备（输入/输出）

每个 I/0 设备都通过一个控制器或适配器与 总线相连。功能都是在 I/O 总线和 I/O 设备之间传递信息。区别在于：

- 控制器：是 I/O 设备本身或者系统的主板上的芯片组。
- 适配器：则是一块插在主板插槽上的卡。



3. 主存

物理上：由动态随机存取存储器（DRAM）芯片组成。

逻辑上：存储器是一个线性的字节数组，每个字节都有其唯一的地址（数组索引）。



4. 处理器

中央处理单元（CPU），简称处理器，是解释（或执行）存储在主存中指令的引擎。



### 1.4.2 运行 hello 程序

在键盘上输入字符串后，会先将字符逐一读入寄存器，再存放到内存中。



按下回车后，认为输入结束，开始从磁盘中复制到主存。

如果使用直接存储器存取（DMA），数据可以不通过处理器，而直接从磁盘到达主存。



当目标文件被加载到主存后，处理器开始执行程序，会依次将字符传从主存复制到寄存器文件，再从寄存器文件中复制到显示设备，最终显示到屏幕上。



## 1.5 高速缓存至关重要

这个简单的示例揭示了一个重要的问题，即系统花费了大量的时间把信息从一个地方挪到另一个地方。

从程序员的角度来看，这些复制就是开销，减慢了程序“真正”的工作



根据机械原理，较大的存储设备要比较小的存储设备运行得慢，而快速设备的造价远高于同类的低速设备。

加快处理器的运行速度比加快主存的运行速度要容易和便宜得多。



高速缓存存储器（cache memory ，简称为 cache 或高速缓存）。

L1 和 L2 高速缓存是用一种叫做静态随机访问存储器（SRAM）的硬件技术实现的。



![image-20250423082609357](https://cdn.jsdelivr.net/gh/FightingBoom/AllPicture@master/img/202504230826469.png)



本书结论：意识到高速缓存存储器存在的应用程序员能够利用高速缓存将程序的性能提高一个数量级。



## 1.6 存储设备形成层次结构

![image-20250424081538744](https://cdn.jsdelivr.net/gh/FightingBoom/AllPicture@master/img/202504240815879.png)



存储器层次结构的主要思想是上一层的存储器作为低一层存储器的高速缓存。



## 1.7 操作系统管理硬件

操作系统有两个基本功能：

（1）防止硬件被失控的应用程序滥用；

（2）向应用程序提供简单一致的机制来控制复杂而又通常大不相同的低级硬件设备。

操作系统通过几个基本的抽象概念（进程、虚拟内存和文件）来实现这两个功能。



Posix 标准。



### 1.7.1 进程

进程是操作系统对一个正在运行的程序的一种抽象。



并发运行：一个进程的指令和另一个进程的指令是交错执行的。



无论是在单核还是多核系统中，一个CPU看上去都像是在并发地执行多个进程，这是通过处理器在进程间切换来实现的。操作系统实现这种交错执行的机制称为上下文切换。



从一个进程到另一个进程的转换是由操作系统内核（kernel）管理的。

内核不是一个独立的进程。相反，它是系统管理全部进程所用代码和数据结构的集合。



### 1.7.2 线程

现代系统，一个进程实际上可以有多个线程组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。



### 1.7.3 虚拟内存

地址从低到高，依次介绍：

- 程序代码和数据。
- 堆。
- 共享库。
- 栈。
- 内核虚拟内存。



虚拟内存的一个基本思想是：把一个进程虚拟内存的内容存储在磁盘上，然后用主存作为磁盘的高速缓存。



### 1.7.4 文件

文件就是字节序列。



## 1.8 系统之间利用网络通信

hello 示例，利用 telnet 在远端服务器执行，并在当前终端返回结果。





















